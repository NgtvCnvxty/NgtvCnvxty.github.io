<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SD Capital Systems</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="landing-page">
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="logo" aria-current="page">SD Capital Systems</a>
            <ul class="nav-links">
                <li><a href="company-overview.html">Company Overview</a></li>
                <li><a href="company-plan.html">Company Plan</a></li>
                <li><a href="fixed-income-marketplace.html">Fixed Income Marketplace</a></li>
                <li><a href="letters-to-canadians.html">Letters to Canadians</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Landing Content -->
    <div class="landing-wrapper">
        <div class="landing-content">
            <div class="hero-text">
                <div class="company-name">Where Canadian's shop for fixed income investment returns.</div>
                <p class="tagline">Single name fixed-income securities from over 30 issuers across 5 fixed-income products including Government of Canada Bonds, Inflation-Linked Bonds, RioCan REIT Bonds, Cineplex Convertible Bonds and Power Financial Preferred Shares.</p>
            </div>
            <div class="signup-form">
                <input type="email" class="signup-input" placeholder="Phone/Email" />
                <button class="signup-button">Receive Updates</button>
            </div>
        </div>
        
        <!-- Bond Data Panel -->
        <div class="bond-panel">
            <h2>Canada Yield Curve</h2>
            <table class="bond-table">
                <thead>
                    <tr id="table-headers">
                        <!-- Headers will be populated from Excel -->
                    </tr>
                </thead>
                <tbody id="bond-data">
                    <!-- Bond data will be populated from Excel -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- SheetJS Library for Excel Reading -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    
    <!-- Bond Data Script -->
    <script>
        // Load and display bond data from Excel file
        async function loadBondData() {
            try {
                // Fetch the Excel file
                const response = await fetch('MarketData/Bonds.xlsx');
                const arrayBuffer = await response.arrayBuffer();
                
                // Parse the Excel file with proper options
                const workbook = XLSX.read(arrayBuffer, {type: 'array'});
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                
                // Extract headers and data from B1:F17 using sheet_to_json
                const matrix = XLSX.utils.sheet_to_json(worksheet, {
                    header: 1,
                    range: 'B1:F17'
                });
                
                if (matrix.length > 0) {
                    const [headers, ...data] = matrix;
                    populateTable(headers, data);
                } else {
                    loadSampleData();
                }
                
            } catch (error) {
                console.error('Error loading bond data:', error);
                // Fallback to sample data
                loadSampleData();
            }
        }
        
        function formatCell(value, columnIndex) {
            if (!value && value !== 0) return '';
            
            switch(columnIndex) {
                case 0: // First column: "0.000%" format
                    const percent1 = parseFloat(value);
                    return Number.isFinite(percent1) ? `${percent1.toFixed(3)}%` : value;
                
                case 1: // Second column: MMM-YYYY date format
                    if (value instanceof Date) {
                        return value.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    } else if (typeof value === 'number') {
                        // Excel date serial number
                        const date = new Date((value - 25569) * 86400 * 1000);
                        return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    }
                    return value;
                
                case 2: // Third column: $000.00 format
                    const currency = parseFloat(value);
                    return Number.isFinite(currency) ? `$${currency.toFixed(2)}` : value;
                
                case 3: // Fourth column: "0.000%" format
                    const percent2 = parseFloat(value);
                    return Number.isFinite(percent2) ? `${percent2.toFixed(3)}%` : value;
                
                case 4: // Fifth column: "0.00" format
                    const decimal = parseFloat(value);
                    return Number.isFinite(decimal) ? decimal.toFixed(2) : value;
                
                default:
                    return value;
            }
        }
        
        function populateTable(headers, data) {
            // Populate headers
            const headerRow = document.getElementById('table-headers');
            headerRow.innerHTML = headers.map(header => `<th>${header || ''}</th>`).join('');
            
            // Populate data
            const tbody = document.getElementById('bond-data');
            tbody.innerHTML = data.map(row => {
                return `<tr>${row.map((cell, index) => {
                    const formattedValue = formatCell(cell, index);
                    
                    // Apply special styling to 5-Day (bps) column (5th column, index 4)
                    if (index === 4) {
                        const numValue = parseFloat(cell);
                        if (Number.isFinite(numValue)) {
                            const className = numValue >= 0 ? 'positive-change' : 'negative-change';
                            return `<td class="${className}">${formattedValue}</td>`;
                        }
                    }
                    return `<td>${formattedValue}</td>`;
                }).join('')}</tr>`;
            }).join('');
        }
        
        function loadSampleData() {
            // Sample data structure for testing
            const headers = ['Term', 'Yield (%)', 'Price', '1-Day (bps)', '5-Day (bps)'];
            const data = [
                ['2Y', '4.25', '99.80', '-2', '5'],
                ['3Y', '4.10', '100.15', '1', '-3'],
                ['5Y', '3.95', '101.20', '3', '8'],
                ['7Y', '3.85', '102.05', '-1', '-5'],
                ['10Y', '3.75', '103.10', '2', '12'],
                ['30Y', '3.90', '104.25', '4', '-8']
            ];
            populateTable(headers, data);
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadBondData();
        });
    </script>
</body>
</html>